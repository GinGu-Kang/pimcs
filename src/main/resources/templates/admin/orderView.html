<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layouts/default}">
<head>
  <meta name="_csrf" th:content="${_csrf.token}"/>
  <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
  <link rel="stylesheet"  href="/css/admin/orderView.css">

  <meta charset="UTF-8">
  <title>Title</title>

</head>
<div layout:fragment="content"  class="content">
  <div th:replace="admin/modal/mappingSerial :: mappingSerial"></div>

  <p class="title">
    주문정보
  </p>
  <section class="qa-container">
    <section th:class="question">
      <p class="sub-title">
        주문자 정보
      </p>
      <div th:class="qna-title">
        <span th:class="write-label" >주문자 메일</th:block></span>
        <span th:class="write-value" th:text="${matOrder.getUser().getEmail()}"></span>
<!--        <div th:if="${question.getAnswer().getId()}!=0" th:class="isAnswer-wrraper"><div th:class="isAnswer-true" >답변 완료</div></div>-->
<!--        <div th:unless="${question.getAnswer().getId()}!=0" th:class="isAnswer-wrraper"><div th:class="isAnswer-false" >답변 미완료</div></div>-->
      </div>
      <hr>
      <p ><span th:class="write-label">입금자 이름</span><span th:class="write-value" th:text="${matOrder.getUser().getName()}"></span></p>
      <hr>
      <p ><span th:class="write-label">주문회사</span><span th:class="write-value" th:text="${matOrder.getCompany().getCompanyName()}"></span></p>
      <hr>
      <p ><span th:class="write-label">회사 코드</span><span th:class="write-value" th:text="${matOrder.getCompany().getCompanyCode()}"></span></p>
      <hr>
      <p ><span th:class="write-label">작성일</span><span th:class="write-value" th:text="${matOrder.getCreatedAt().toString().replace('-','.').substring(0,10)}"></span></p>
      <hr>
      <p ><span th:class="write-label">희망 배송일</span><span th:class="write-value" th:text="${matOrder.getHopeDeliveryDate().toString().replace('-','.').substring(0,10)}"></span></p>
      <p class="sub-title">
        배송지 정보
      </p>
      <p ><span th:class="write-label">우편 번호</span><span th:class="write-value" th:text="${matOrder.getPostCode()}"></span></p>
      <hr>
      <p ><span th:class="write-label">배송 주소</span><span th:class="write-value" th:text="${matOrder.getDeliveryAddress()}"></span></p>
      <hr>
      <p class="sub-title">
        가격 정보
      </p>
      <th:block th:each="matCategoryOrder:${matOrder.getMatCategoryOrderList()}">
        <p ><span th:class="write-label" th:text="${matCategoryOrder.getMatCategory().getMatCategoryName()}+' 주문갯수'"></span><span th:class="write-value" th:text="${matCategoryOrder.getOrderCnt()}"></span></p>
        <hr>
        <p ><span th:class="write-label" th:text="${matCategoryOrder.getMatCategory().getMatCategoryName()}+' 기기가격'"></span><span th:class="write-value" th:text="${matCategoryOrder.getMatCategory().getMatPrice()}"></span></p>
        <hr>
        <br>
      </th:block>
      <p><span th:class="write-label" id="totalPrice">총 금액</span><span th:class="write-value" th:text="${matOrder.getTotalPrice()}"></span></p>
      <p class="sub-title">
        배송된 기기
      </p>
      <th:block th:each="matCategoryOrder:${matOrder.getMatCategoryOrderList()}">
        <p ><span th:class="write-label" th:text="${matCategoryOrder.getMatCategory().getMatCategoryName()}+' 주문갯수'"></span><span th:class="write-value" th:text="${matCategoryOrder.getOrderCnt()}"></span></p>
        <hr>
        <p ><span th:class="write-label" th:text="${matCategoryOrder.getMatCategory().getMatCategoryName()}+' 기기가격'"></span><span th:class="write-value" th:text="${matCategoryOrder.getMatCategory().getMatPrice()}"></span></p>
        <hr>
        <br>
      </th:block>
    </section>
  </section>
  <p id="list-p"><a th:class="list-button"  th:href="@{/admin/order/list}">목록</a> <a th:class="list-button" data-toggle="modal" data-target="#mappingSerial" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#depositModal">입금 상태 변경</a> <a th:class="list-button" data-toggle="modal" data-target="#mappingSerial" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#deliveryModal">배송</a></p>
  <script>

    function deliverySave(){
      let result = confirm("배송된 기기의 시리얼이 일치 합니까?");
      let duplicateCheck = 0;
      if(result){
        if(duplicateCheck){
          alert("저장되었습니다.");
        }else {
          alert("중복된 기기가 존재합니다.(WS@)!@))");
        }

      //  orderview로 새로고침 이후 맨 밑에 배송된 기기들 보여주기 이메일 전송하기
      } else {
        alert("취소되었습니다.");
      }

    }



    function inputFormChange(){
      let changeButton=$("#form-change-button")
      if(changeButton.text()=="CSV 입력"){
        $("#csv-input").css("display","block")
        $("#self-input").css("display","none")
        changeButton.text("직접 입력")
      }
      else{
        $("#csv-input").css("display","none")
        $("#self-input").css("display","block")
        changeButton.text("CSV 입력")
      }


    }


    function isDeposit(){
      let isChange = confirm("입금상태를 변경 하시겠습니까?");
      let result = 0;
      if(isChange){
        result = confirm("확인을 누르시면 입금완료상태로 변경 됩니다.")
        if(result){
          alert("입금 완료 상태로 변경되었습니다.");
        }else {
          alert("입금 미완료 상태로 변경되었습니다.");
        }
      }else {
        alert("취소되었습니다");
      }
    }
    function depositChange(){



      /*<![CDATA[*/
      let matOrderId = "/order/deposit/"+"[[${matOrder.getId()}]]";
      /*]]>*/

      $.ajax({
        url:matOrderId,
        type:'put',
        data:{email:email},
        beforeSend : function(xhr)
        {   /*데이터를 전송하기 전에 헤더에 csrf값을 설정한다*/
          xhr.setRequestHeader(header, token);
        },
        success:function(isEmail){ //컨트롤러에서 넘어온 cnt값을 받는다
          if(isEmail){ //cnt가 1이 아니면(=0일 경우) -> 사용 가능한 아이디
            $('.email_already').css("display", "none");
            $('.email_ok').css("display","inline-block");

          } else { // cnt가 1일 경우 -> 이미 존재하는 아이디
            $('.email_already').css("display","inline-block");
            $('.email_ok').css("display", "none");
          }
        },
        error:function(){
          alert("에러입니다");
        }
      });
    };
  </script>
</div>



</div>

</html>